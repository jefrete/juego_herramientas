<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Emparejar Herramientas de Carpinter√≠a</title>
  <style>
    :root{
      --bg: #0f172a;         /* slate-900 */
      --card: #111827;       /* gray-900 */
      --muted: #94a3b8;      /* slate-400 */
      --ok: #16a34a;         /* green-600 */
      --bad: #dc2626;        /* red-600 */
      --accent: #f59e0b;     /* amber-500 */
    }
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0b1225,#0f172a 25%,#0b1225);color:#e5e7eb;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji"}
    .wrap{max-width:1100px;margin:0 auto;padding:clamp(12px,3vw,28px)}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:12px}
    h1{font-size:clamp(22px,4vw,36px);margin:0;font-weight:800;letter-spacing:.3px}
    .hint{color:var(--muted);font-size:clamp(13px,2.4vw,16px)}

    .board{display:grid;grid-template-columns:1fr;gap:14px}
    @media (min-width:900px){.board{grid-template-columns:1.2fr .8fr}}

    .gallery{display:grid;grid-template-columns:1fr;gap:14px}
    @media (min-width:560px){.gallery{grid-template-columns:1fr 1fr}}

    .photo{position:relative;background:var(--card);border-radius:18px;overflow:hidden;min-height:220px;box-shadow:0 10px 30px rgba(0,0,0,.35);outline:2px solid transparent;transition:outline-color .15s ease}
    .photo img{width:100%;height:260px;object-fit:cover;display:block;filter:saturate(1.05) contrast(1.02)}
    .photo .label{position:absolute;inset:auto 10px 10px 10px;background:rgba(2,6,23,.75);backdrop-filter:saturate(140%) blur(4px);border:1px solid rgba(255,255,255,.12);border-radius:14px;padding:12px 14px;font-weight:700;display:flex;justify-content:space-between;align-items:center;gap:8px}
    .drop-hint{font-size:14px;color:var(--muted)}

    .tools{background:rgba(17,24,39,.7);border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:14px;display:flex;flex-wrap:wrap;gap:10px;align-content:flex-start;min-height:120px}
    .chip{user-select:none;-webkit-user-drag:element;cursor:grab;background:#1f2937;border:1px solid rgba(255,255,255,.1);border-radius:999px;padding:12px 16px;font-weight:800;letter-spacing:.3px;box-shadow:0 6px 20px rgba(0,0,0,.25);transition:transform .08s ease, box-shadow .08s ease, background .15s ease}
    .chip:active{cursor:grabbing;transform:scale(.98)}
    .chip[aria-disabled="true"]{opacity:.5;cursor:not-allowed}

    .photo.ok{outline-color:var(--ok)}
    .photo.bad{animation:shake .25s linear}
    @keyframes shake{25%{transform:translateX(-3px)}50%{transform:translateX(3px)}75%{transform:translateX(-2px)}100%{transform:translateX(0)}}

    .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:10px 0 4px}
    button{background:var(--accent);color:#111827;border:none;border-radius:999px;padding:10px 14px;font-weight:900;cursor:pointer;box-shadow:0 10px 24px rgba(0,0,0,.35);letter-spacing:.3px}
    button:active{transform:translateY(1px)}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

    .audio-panel{margin-top:14px;background:rgba(2,6,23,.5);border:1px dashed rgba(255,255,255,.2);border-radius:16px;padding:12px}
    .audio-grid{display:grid;grid-template-columns:1fr;gap:10px}
    @media (min-width:700px){.audio-grid{grid-template-columns:1fr 1fr}}
    .audio-row{display:flex;gap:8px;align-items:center;justify-content:space-between;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:8px 10px}
    .audio-row label{font-weight:700}
    .audio-row input[type=file]{max-width:60%}

    footer{margin-top:22px;color:#94a3b8;font-size:12px;line-height:1.5}
    footer a{color:#a5b4fc}
  </style>
</head>
<body>
  <div class="wrap" role="application" aria-label="Juego de emparejar herramientas de carpinter√≠a">
    <header>
      <div>
        <h1>Emparejar herramientas üî®ü™ö</h1>
        <div class="hint">Arrastr√° una <strong>herramienta</strong> y soltarla sobre la <strong>foto</strong> correcta. En celular: <strong>tocar herramienta</strong> ‚Üí <strong>tocar foto</strong>.</div>
      </div>
      <div class="controls">
        <button id="btnReiniciar" title="Reiniciar el juego">Reiniciar</button>
        <button id="btnTips" title="Leer indicaciones">üîä Leer</button>
      </div>
    </header>

    <main class="board">
      <section class="gallery" id="gallery" aria-label="Fotos para emparejar">
        <!-- Las fotos se inyectan desde JS -->
      </section>

      <aside>
        <h2 class="sr-only">Herramientas</h2>
        <div class="tools" id="tools" aria-label="Herramientas, arrastrables" aria-live="polite">
          <!-- Chips de herramientas -->
        </div>

        <!-- Panel de audios humanos opcionales -->
        <section class="audio-panel" aria-label="Audios personalizados">
          <strong>üéôÔ∏è Audios personalizados (opcional)</strong>
          <p class="hint" style="margin:6px 0 10px">Carg√° grabaciones humanas para reemplazar la voz rob√≥tica. Acepta MP3/WAV/M4A. Se usan al instante (no se guardan al cerrar la p√°gina).</p>
          <div class="audio-grid" id="audioGrid"><!-- filas creadas por JS --></div>
        </section>
      </aside>
    </main>

    <footer>
      <div>Consejo: us√° la tecla <kbd>Tab</kbd> para recorrer y <kbd>Enter</kbd> para emparejar con selecci√≥n por teclado.</div>
    </footer>
  </div>

  <script>
  // ===== IM√ÅGENES (pod√©s cambiarlas por otras URLs libres) =====
  const IMAGES = [
    { id: 'martillo', title: 'Martillo (hammer)', credit: 'MOMPATI 2 ‚Äî CC BY-SA 4.0', src: 'https://upload.wikimedia.org/wikipedia/commons/7/7e/Man_extracting_nails_from_a_plank_using_a_claw_hammer.jpg' },
    { id: 'serrucho', title: 'Serrucho (hand saw)', credit: 'UVic Libraries ‚Äî Public domain/No restrictions', src: 'https://upload.wikimedia.org/wikipedia/commons/3/3e/Man_using_handsaw_on_tree_trunk._%2819762147198%29.jpg' },
    { id: 'taladro',  title: 'Taladro (electric drill)', credit: 'U.S. Navy / Public Domain', src: 'https://upload.wikimedia.org/wikipedia/commons/8/88/171215-N-KA046-0216_%2839098914442%29.jpg' },
    { id: 'lijadora', title: 'Lijadora (sander)', credit: 'Unsplash ‚Äî Paul Trienekens', src: 'https://unsplash.com/photos/mLO6ILUbADA/download?force=true&fm=jpg&w=1400' },
    { id: 'formon',   title: 'Form√≥n (chisel)', credit: 'Scott Brown ‚Äî CC BY-SA 2.0', src: 'https://upload.wikimedia.org/wikipedia/commons/6/6a/Man_chiselling.jpg' },
    { id: 'cinta',    title: 'Cinta m√©trica (tape measure)', credit: 'Rwebogora ‚Äî CC BY-SA 4.0', src: 'https://upload.wikimedia.org/wikipedia/commons/4/43/A_carpenter_creating_measurements.jpg' }
  ];

  const TOOLS = [
    { id: 'martillo', label: 'üî® Martillo' },
    { id: 'serrucho', label: 'ü™ö Serrucho' },
    { id: 'taladro',  label: 'üîß Taladro' },
    { id: 'lijadora', label: 'üåÄ Lijadora' },
    { id: 'formon',   label: 'ü™µ Form√≥n' },
    { id: 'cinta',    label: 'üìè Cinta m√©trica' }
  ];

  const gallery = document.getElementById('gallery');
  const toolsBox = document.getElementById('tools');
  const btnReiniciar = document.getElementById('btnReiniciar');
  const btnTips = document.getElementById('btnTips');
  const audioGrid = document.getElementById('audioGrid');

  // ====== Audio humano opcional ======
  // Mapeo de claves ‚Üí URL de audio (Object URLs de archivos cargados)
  const AUDIO_MAP = {
    ok: null,
    try_again: null,
    tool_martillo: null,
    tool_serrucho: null,
    tool_taladro: null,
    tool_lijadora: null,
    tool_formon: null,
    tool_cinta: null,
    intro: null
  };

  const AUDIO_LABELS = {
    ok: 'Audio de acierto ("¬°Muy bien!")',
    try_again: 'Audio de volver a intentar (suave)',
    tool_martillo: 'Decir: "Martillo"',
    tool_serrucho: 'Decir: "Serrucho"',
    tool_taladro: 'Decir: "Taladro"',
    tool_lijadora: 'Decir: "Lijadora"',
    tool_formon: 'Decir: "Form√≥n"',
    tool_cinta: 'Decir: "Cinta m√©trica"',
    intro: 'Instrucciones (opcional)'
  };

  function buildAudioPanel(){
    audioGrid.innerHTML = '';
    Object.keys(AUDIO_MAP).forEach(key => {
      const row = document.createElement('div');
      row.className = 'audio-row';
      const label = document.createElement('label');
      label.textContent = AUDIO_LABELS[key] || key;
      label.setAttribute('for', 'file_'+key);

      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'audio/*';
      input.id = 'file_'+key;
      input.addEventListener('change', (e)=>{
        const file = e.target.files && e.target.files[0];
        if(file){
          if(AUDIO_MAP[key]) URL.revokeObjectURL(AUDIO_MAP[key]);
          AUDIO_MAP[key] = URL.createObjectURL(file);
        }
      });

      const testBtn = document.createElement('button');
      testBtn.type = 'button';
      testBtn.textContent = '‚ñ∂Ô∏é Probar';
      testBtn.addEventListener('click', ()=> playAudio(key, {fallbackTTSText: label.textContent}));

      const clearBtn = document.createElement('button');
      clearBtn.type = 'button';
      clearBtn.textContent = '‚úï Quitar';
      clearBtn.addEventListener('click', ()=>{
        if(AUDIO_MAP[key]) URL.revokeObjectURL(AUDIO_MAP[key]);
        AUDIO_MAP[key] = null;
      });

      row.appendChild(label);
      row.appendChild(input);
      row.appendChild(testBtn);
      row.appendChild(clearBtn);
      audioGrid.appendChild(row);
    });
  }

  function playAudio(key, opts={}){
    const url = AUDIO_MAP[key];
    if(url){
      const a = new Audio(url);
      a.play().catch(()=>{});
      return;
    }
    // Fallbacks: primero SpeechSynthesis (si hay), si no, beep
    if(opts.fallbackTTSText){ speak(opts.fallbackTTSText); return; }
    beep(660, .1);
  }

  // Sonidos simples (WebAudio) como √∫ltimo recurso
  const audioCtx = typeof window !== 'undefined' && 'AudioContext' in window ? new AudioContext() : null;
  function beep(freq = 880, time = 0.15){
    if(!audioCtx) return;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = 'sine';
    o.frequency.value = freq;
    g.gain.value = 0.08;
    o.connect(g).connect(audioCtx.destination);
    o.start();
    setTimeout(()=>{o.stop();}, time*1000);
  }

  function speak(text){
    if(!('speechSynthesis' in window)) return;
    const u = new SpeechSynthesisUtterance(text);
    u.lang = 'es-AR';
    u.rate = 0.92;
    speechSynthesis.cancel();
    speechSynthesis.speak(u);
  }

  // Render fotos
  function renderGallery(){
    gallery.innerHTML = '';
    IMAGES.forEach(img => {
      const card = document.createElement('div');
      card.className = 'photo';
      card.tabIndex = 0;
      card.role = 'button';
      card.ariaLabel = `Foto: ${img.title}. Solt√° ac√° la herramienta correcta`;
      card.dataset.accept = img.id;
      card.addEventListener('dragover', (e)=>{ e.preventDefault(); });
      card.addEventListener('drop', onDrop);
      card.addEventListener('click', ()=> tryMatchSelection(card));

      const elImg = document.createElement('img');
      elImg.alt = img.title;
      elImg.src = img.src;

      const label = document.createElement('div');
      label.className = 'label';
      label.innerHTML = `<span class="drop-hint">Solt√° aqu√≠ la herramienta</span><span style="opacity:.7">${img.credit}</span>`;

      card.appendChild(elImg);
      card.appendChild(label);
      gallery.appendChild(card);
    });
  }

  // Render herramientas
  function renderTools(){
    toolsBox.innerHTML = '';
    shuffle([...TOOLS]).forEach(t => {
      const chip = document.createElement('div');
      chip.className = 'chip';
      chip.draggable = true;
      chip.textContent = t.label;
      chip.id = `tool-${t.id}`;
      chip.setAttribute('role','button');
      chip.setAttribute('aria-label', t.label + ', arrastrable. Tocar para seleccionar');
      chip.dataset.tool = t.id;
      chip.addEventListener('dragstart', onDragStart);
      chip.addEventListener('click', ()=> onChipClick(chip));
      toolsBox.appendChild(chip);
    });
  }

  function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
  }

  // Estado de selecci√≥n por toque/teclado
  let selectedChip = null;

  function onChipClick(chip){
    if(chip.getAttribute('aria-disabled')==='true') return;
    if(selectedChip && selectedChip!==chip){
      selectedChip.style.outline = 'none';
    }
    selectedChip = chip;
    chip.style.outline = '3px solid var(--accent)';
    // Audio humano para el nombre de la herramienta
    const key = 'tool_'+chip.dataset.tool;
    playAudio(key, {fallbackTTSText: chip.textContent});
  }

  function tryMatchSelection(targetCard){
    if(!selectedChip) return; // nada seleccionado
    const ok = targetCard.dataset.accept === selectedChip.dataset.tool;
    finishAttempt(targetCard, selectedChip, ok);
  }

  function onDragStart(ev){
    ev.dataTransfer.setData('text/plain', ev.target.dataset.tool);
    ev.dataTransfer.effectAllowed = 'move';
    selectedChip = ev.target; // mantener referencia
    const key = 'tool_'+selectedChip.dataset.tool;
    playAudio(key, {fallbackTTSText: selectedChip.textContent});
  }

  function onDrop(ev){
    ev.preventDefault();
    const tool = ev.dataTransfer.getData('text/plain');
    const chip = selectedChip;
    const ok = ev.currentTarget.dataset.accept === tool;
    finishAttempt(ev.currentTarget, chip, ok);
  }

  function finishAttempt(card, chip, ok){
    if(!chip || chip.getAttribute('aria-disabled')==='true') return;
    card.classList.remove('bad','ok');

    if(ok){
      card.classList.add('ok');
      const label = card.querySelector('.label');
      label.innerHTML = `<strong>‚úî ${chip.textContent}</strong>`;
      playAudio('ok', {fallbackTTSText: '¬°Muy bien!'});
      chip.setAttribute('aria-disabled','true');
      chip.style.opacity = .5;
      chip.style.cursor = 'default';
      chip.draggable = false;
      chip.removeEventListener('click', onChipClick);
      chip.style.outline = 'none';
      selectedChip = null;
      checkWin();
    }else{
      card.classList.add('bad');
      playAudio('try_again', {fallbackTTSText: 'Intent√° de nuevo'});
      setTimeout(()=> card.classList.remove('bad'), 250);
    }
  }

  function checkWin(){
    const left = [...document.querySelectorAll('.chip')].filter(c=>c.getAttribute('aria-disabled')!== 'true');
    if(left.length===0){
      setTimeout(()=>{
        alert('¬°Genial! Emparejaste todas las herramientas.');
      }, 150);
    }
  }

  btnReiniciar.addEventListener('click', ()=>{
    renderGallery();
    renderTools();
    selectedChip = null;
    playAudio('intro', {fallbackTTSText: 'Juego reiniciado'});
  });

  btnTips.addEventListener('click', ()=>{
    playAudio('intro', {fallbackTTSText: 'Arrastr√° una herramienta hacia la foto correcta. En celular, toc√° la herramienta y luego la foto.'});
  });

  // Inicializar
  renderGallery();
  renderTools();
  buildAudioPanel();
  </script>
</body>
</html>
